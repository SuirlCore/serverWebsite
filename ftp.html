<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Server</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 600px; margin: auto; }
        .file-list { margin-top: 20px; }
        .file-item { display: flex; justify-content: space-between; padding: 5px; border-bottom: 1px solid #ddd; }
    </style>
</head>
<body>
    <div class="container">
        <h2>File Server</h2>
        <p>Storage Used: <span id="storageUsed">Calculating...</span> / 10GB</p>
        <input type="file" id="fileInput">
        <button onclick="uploadFile()">Upload</button>
        
        <input type="text" id="folderName" placeholder="Folder Name">
        <button onclick="createFolder()">Create Folder</button>
        
        <input type="text" id="currentPath" value="" readonly>
        <button onclick="navigateUp()">Go Up</button>
        
        <div class="file-list" id="fileList"></div>
    </div>

    <script>
        let currentPath = "";
        
        function fetchFiles() {
            fetch(`scripts/files.php?path=${encodeURIComponent(currentPath)}`)
                .then(response => response.json())
                .then(files => {
                    let fileList = document.getElementById('fileList');
                    fileList.innerHTML = '';
                    files.forEach(file => {
                        let div = document.createElement('div');
                        div.className = 'file-item';
                        if (file.isDir) {
                            div.innerHTML = `<span onclick="navigateTo('${file.name}')" style="cursor: pointer; color: blue;">üìÅ ${file.name}</span> <button onclick="deleteFolder('${file.name}')">Delete</button>`;
                        } else {
                            div.innerHTML = `<span>${file.name}</span> <a href='uploads/${currentPath}/${file.name}' download>Download</a> <button onclick="deleteFile('${file.name}')">Delete</button> <button onclick="moveFile('${file.name}')">Move</button>`;
                        }
                        fileList.appendChild(div);
                    });
                    document.getElementById('currentPath').value = currentPath;
                    fetchStorageUsed();
                });
        }

        function fetchStorageUsed() {
            fetch('scripts/storage.php')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('storageUsed').innerText = data;
                });
        }
        
        function uploadFile() {
            let fileInput = document.getElementById('fileInput');
            let file = fileInput.files[0];
            let formData = new FormData();
            formData.append('file', file);
            formData.append('path', currentPath);
            
            fetch('scripts/upload.php', {
                method: 'POST',
                body: formData
            }).then(response => response.text())
              .then(data => {
                  alert(data);
                  fetchFiles();
              });
        }
        
        function createFolder() {
            let folderName = document.getElementById('folderName').value;
            fetch('scripts/folder.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'create', name: folderName, path: currentPath })
            }).then(response => response.text())
              .then(data => {
                  alert(data);
                  fetchFiles();
              });
        }

        function deleteFolder(folderName) {
            fetch('scripts/folder.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'delete', name: folderName, path: currentPath })
            }).then(response => response.text())
              .then(data => {
                  alert(data);
                  fetchFiles();
              });
        }

        function deleteFile(fileName) {
            fetch('scripts/file.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'delete', name: fileName, path: currentPath })
            }).then(response => response.text())
              .then(data => {
                  alert(data);
                  fetchFiles();
              });
        }

        function moveFile(fileName) {
            let newPath = prompt("Enter the new folder path:", currentPath);
            if (newPath !== null) {
                fetch('scripts/file.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'move', name: fileName, path: currentPath, newPath: newPath })
                }).then(response => response.text())
                  .then(data => {
                      alert(data);
                      fetchFiles();
                  });
            }
        }

        function navigateTo(folderName) {
            currentPath = currentPath ? `${currentPath}/${folderName}` : folderName;
            fetchFiles();
        }

        function navigateUp() {
            let pathParts = currentPath.split('/');
            pathParts.pop();
            currentPath = pathParts.join('/');
            fetchFiles();
        }

        fetchFiles();
    </script>
</body>
</html>
